{"name":"Dropbox Client for ImageJ","tagline":"Google Summer of Code 2014 - International Neuroinformatics Coordinating Facility (INCF, Belgian Node)","body":"![](https://dl.dropboxusercontent.com/u/52328771/Atin%20GSoC%20proposal/GSoC-incf-2014.png)\r\n\r\n# [Dropbox Client for ImageJ](https://www.google-melange.com/gsoc/project/details/google/gsoc2014/atin007/5685265389584384)\r\n\r\n**This project is sponsored by Google Inc. as a part of Google Summer of Code 2014 program.**\r\n\r\nDetails of this project are:\r\n\r\n1. **Organization:**\t[International Neuroinformatics Coordinating Facility (INCF)](http://incf.org)\r\n2. **Mentor:**\tDimiter Prodanov, [INCF Belgian Node](http://www.neuroinformatics.be)\r\n3. **Student Developer:**\t[Atin Mathur](https://www.linkedin.com/in/atinmathur10) (mathuratin007@gmail.com)\r\n4. **Working Period:**\tMay - August, 2014\r\n5. **Public Repository:**\t[http://github.com/INCF/dbclient](http://github.com/INCF/dbclient)\r\n\r\n## [ImageJ](http://imagej.nih.gov/ij/)\r\n\r\n![](https://dl.dropboxusercontent.com/u/52328771/Atin%20GSoC%20proposal/imageJ.jpg)\r\n\r\nImageJ is a public domain Java image processing program inspired by NIH Image for the Macintosh. It runs, either as an online applet or as a downloadable application, on any computer with a Java 1.4 or later virtual machine. [Downloadable distributions](http://rsbweb.nih.gov/ij/download.html) are available for Windows, Mac OS, Mac OS X and Linux.\r\n\r\nIt can display, edit, analyze, process, save and print 8-bit, 16-bit and 32-bit images. It can read many image formats including TIFF, GIF, JPEG, BMP, DICOM, FITS and \"raw\". It supports \"stacks\", a series of images that share a single window. It is multithreaded, so time-consuming operations such as image file reading can be performed in parallel with other operations.\r\n\r\nImageJ was designed with an open architecture that provides extensibility via Java plugins. Custom acquisition, analysis and processing plugins can be developed using ImageJ's built in editor and Java compiler. User-written plugins make it possible to solve almost any image processing or analysis problem. It is now being used in vast number of imaging applications ranging from skin analysis to neuroscience.\r\n\r\n## Project Proposal\r\n\r\nOur project aims at developing an ImageJ plugin which will provide users with a Graphical user interface (GUI) to upload and download datasets (images, docs, folders, codes etc.) from their Dropbox accounts (using Dropbox Core APIs for Java) and open it directly into ImageJ. My project Proposal can be found [here](https://dl.dropboxusercontent.com/u/52328771/Atin%20GSoC%20proposal/Atin%20Mathur_gsoc_incf-proposal.pdf).\r\n\r\n\r\n## Project Milestones\r\n\r\n**In this section, I will describe how I developed this project.**\r\n\r\n### Step 1\t:\tRead Dropbox Core APIs for Java  and ImageJ Basics. (Week 1)\r\n\r\nThe Dropbox Core APIs provides a flexible way to read and write to Dropbox. It includes support for advanced functionality like search, revisions, and restoring files. The Core API is based on HTTP and OAuth and provides low-level calls to access and manipulate a user's Dropbox account.\r\n\r\nTo make things as easy as possible, dropbox has provided several platform SDKs which can be imported into any development  environment. The SDKs contain platform-specific libraries that wrap the raw HTTP calls to the Dropbox API.\r\n\r\nI read the complete documentation of Dropbox Core APIs from [here](http://dropbox.github.io/dropbox-sdk-java/api-docs/v1.7.x/com/dropbox/core/DbxClient.html). It is quite simple and informative.\r\n\r\n### Step 2\t:\tWrote a sample program to use Dropbox API to access/upload/download from my Dropbox account. (Week 2)\r\n\r\n**Steps**\r\n\r\n1. First, I registered a new Dropbox API app in the [App Console](https://www.dropbox.com/developers/apps) (We'll need the app key to access the Core API).\r\n\r\n2. After that, I installed the [Java SDK](https://www.dropbox.com/developers/core/sdks/java).\r\n\r\n3. Next, I installed [Eclipse for Java](http://www.eclipse.org/downloads/packages/eclipse-ide-java-developers/keplersr1) for plugin development. \r\n\r\n4. Then, I created a test project and added the following code.\r\n\r\n```\r\n// Include the Dropbox SDK.\r\nimport com.dropbox.core.* ; \r\nimport java.io.*;\r\nimport java.util.Locale;\r\n\r\npublic class testDropbox {\r\n    public static void main(String[] args) throws IOException, DbxException {\r\n        \r\n\t\t//\tGet your APP Key and Secret from the Dropbox developers website.\r\n        final String APP_KEY = \"Insert <APP_KEY> here\";\r\n        final String APP_SECRET = \"Insert <APP_SECRET> here\";\r\n\r\n        DbxAppInfo appInfo = new DbxAppInfo(APP_KEY, APP_SECRET);\r\n\r\n        DbxRequestConfig config = new DbxRequestConfig(\"JavaTutorial/1.0\", Locale.getDefault().toString());\r\n        DbxWebAuthNoRedirect webAuth = new DbxWebAuthNoRedirect(config, appInfo);\r\n\r\n        //\tHave the user sign in and authorize your APP .\r\n        String authorizeUrl = webAuth.start();\r\n        System.out.println(\"1. Go to: \" + authorizeUrl);\r\n        System.out.println(\"2. Click \\\"Allow\\\" (you might have to log in first)\");\r\n        System.out.println(\"3. Copy the authorization code.\");\r\n        String code = new BufferedReader(new InputStreamReader(System.in)).readLine().trim();\r\n\r\n        //\tThis will fail if the user enters an invalid authorization code.\r\n        DbxAuthFinish authFinish = webAuth.finish(code);\r\n        String accessToken = authFinish.accessToken;\r\n\r\n        DbxClient client = new DbxClient(config, accessToken);\r\n\t\r\n\t\t//\tMessage will be displayed after successful connection with <Dropbox_Username>\r\n\t\tSystem.out.println(\"Linked account: \" + client.getAccountInfo().displayName);\r\n\r\n\t\t//\tUpload a file from your local machine to dropbox\r\n        File inputFile = new File(\"Insert a <FILE_ABSOLUTE PATH> here>\");\r\n        FileInputStream inputStream = new FileInputStream(inputFile);\r\n        try {\r\n        \t   DbxEntry.File uploadedFile = client.uploadFile(\"Insert <DROPBOX_FILE_PATH> where you want to upload the file here\",\r\n               DbxWriteMode.add(), inputFile.length(), inputStream);\r\n            System.out.println(\"Uploaded: \" + uploadedFile.toString());\r\n        } finally {\r\n            inputStream.close();\r\n        }\r\n\r\n\t\t//\tTo list the children (files, sub-folders present in a given folder of Dropbox)\r\n        DbxEntry.WithChildren listing = client.getMetadataWithChildren(\"Insert <DROPBOX_PATH> here\");\r\n        System.out.println(\"Files in the <DROPBOX_PATH> are :\");\r\n        for (DbxEntry child : listing.children) {\r\n            System.out.println(\"\t\" + child.name + \": \" + child.toString());\r\n        }\r\n\t\r\n\t\t//\tDownload a file from <DROPBOX_FILE_PATH>\r\n        FileOutputStream outputStream = new FileOutputStream(\"Insert <LOCAL_PATH> where you want to save the file here\");\r\n        try {\r\n            DbxEntry.File downloadedFile = client.getFile(\"Insert <DROPBOX_FILE_PATH> here\", null,\r\n                outputStream);\r\n            System.out.println(\"Metadata: \" + downloadedFile.toString());\r\n        } finally {\r\n            outputStream.close();\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n**After creating this test project, my next goal was to configure ImageJ with eclipse.**\r\n\r\n### Step 3\t:\tConfigured ImageJ with Eclipse and created a plugin that could connect to a user's Dropbox account. (Week 3)\r\n\r\n1. Step by Step configured the ImageJ with Eclipse using the **Method 1** of this [tutorial](http://imagejdocu.tudor.lu/doku.php?id=howto:plugins:the_imagej_eclipse_howto).\r\n\r\n2. Created a sample plugin that could connect to a user's dropbox account.\r\n\r\n**Note:** This plugin was running quite well in Eclipse on my computer. But, when I sent the JAR file to my mentor. He was not able to run it. After a lot of analysis, I found that I have not zipped the Dropbox SDK within the JAR file. After, I corrected this problem, my mentor was able to run this plugin on his computer. **The plugin could be deployed now.** The next step was to add the upload/download functionalities into the plugin.\r\n\r\n### Step 4\t:\tAdded the download/upload functionality in the ImageJ plugin. (Week 4)\r\n\r\nAs I had already created the test code for download/upload. I created separate functions for download/upload-ing  a file in **class DbxUtils.DbxUtility**. These functions are as follows:\r\n\r\n\t\t /* Function to download a \"File\" from Dropbox given the complete path of the file in \r\n\t\t \tDropbox and also local machine path where the \"File\" has to be saved.\r\n\t\t */\r\n\t\tpublic void DbxDownloadFile(String FileDbxPath, String TargetLocalPath) throws IOException, DbxException\r\n\t\t{\r\n\t\t\tString fileName = FileDbxPath.substring(FileDbxPath.lastIndexOf(\"/\"));\r\n\t\t\tTargetLocalPath += fileName;\r\n\t\t\tFile SaveAsFile = new File(TargetLocalPath);\r\n\t        OutputStream outputStream = new FileOutputStream(SaveAsFile);\r\n\t        try {\r\n\t        @SuppressWarnings(\"unused\")\r\n\t\t\tDbxEntry.File downloadedFile = client.getFile(FileDbxPath, null, outputStream);\r\n\t        } finally {\r\n\t            outputStream.close();\r\n\t        }\r\n\t\t}\r\n\t\r\n\r\n\r\n\t\t /* Function to upload a \"File\" to Dropbox given the complete path of the file in local machine and the \r\n\t\t  *\tDropbox folder's path where \"File\" has to be saved.   \r\n\t\t  */\r\n\t\tpublic void DbxUploadFile(String FileLocalPath, String TargetDbxPath) throws IOException, DbxException \r\n\t\t{\r\n\t        File inputFile = new File(FileLocalPath);\r\n\t        InputStream inputStream = new FileInputStream(inputFile);\r\n\t        try {\r\n\t\t        if(!inputFile.isHidden()) {\r\n\t\t        \t@SuppressWarnings(\"unused\")\r\n\t\t\t\t\tDbxEntry.File uploadedFile = client.uploadFile(TargetDbxPath, DbxWriteMode.add(), inputFile.length(), inputStream);\r\n\t\t        }\r\n\t\t        } finally {\r\n\t\t            inputStream.close();\r\n\t\t        }\r\n\t\t}\r\n\r\nAdded a simple GUI for testing these functions. The user had to manually enter source address and target address in the text fields. In the next few weeks, I added the browse feature in the plugin.\r\n\r\n### Step 5\t:\tImproved the Graphical User Interface of the plugin. (Week 5, 6)\r\n\r\nIn these week, I worked on improving the GUI for plugin. I set the JFrame to a proper size. I added **instructions** text for new user's help. I improved the layout of the plugin. I also added the menu options for Download and Upload. Also, added the **download/upload folder option**. \r\n\r\n1. **Folders are downloaded by iteratively calling DbxDownloadFile() function for each file in the folder**.\r\n\r\n2. **Folders are uploaded by iteratively calling DbxUploadFile() function for each file in the folder**.\r\n\r\n##Midterm Evaluation\r\n\r\nBefore Midterm evaluation, I was able to create a plugin with a simple GUI which could download/upload a file/folder from a user's dropbox account. After midterm, I worked to enable the following feature: \r\n\r\n**Browsing the Dropbox site remotely to add the source/target path for download/upload**.\r\n\r\n### Step 6\t:\tAdded JTree for browsing Dropbox folders remotely. (Week 8, 9)\r\n\r\nAdding the browsing feature in this plugin was quite a challenge. I had to download the metadata from dropbox site and then display it to user **(using a JTree)**.\r\n\r\nI tried following methods to do the same:\r\n\r\n1. After connecting to the user's Dropbox account, I called `getMetaDataWithChildren(PATHNAME)` recursively for complete dropbox account and added each folder/file to a node in JTree (Similar to a Directory Structure). \r\n\r\n\t**But this took a lot of time. This was not feasible for our application. So, I solved this problem as follows:**\r\n\r\n2. So, I downloaded metadata of only the top-level folders in the Dropbox Hierarchy and added those as JTree nodes. I only downloaded metadata of the folders which users wanted to **Expand**. This gave us with a run-time solution.\r\n\r\n**Thus, JTree was added for browsing functionality**.\r\n\r\n### Step 7\t:\t Changed the GUI quite a bit and added the open the file after upload/download functionality. (Week 10)\r\n\r\n1. In this week, I changed the GUI quite a bit. I used nested JPanels for proper alignment of the individual components(JButton, JTextField etc.) of the GUI. I also removed the menu bar and placed the Download/Upload panel in the right side of the original JFrame. Thus, the complete complete plugin was now has only one JFrame with many JPanels. The GUI looked quite elegant and simple to use.\r\n\r\n2. On recommendation of my mentor, I also added the open a file feature. So, I added the code to open the file/folder in OS default application.\r\n\r\n### Step 8\t:\tTesting the code and handling exceptions wherever needed. (Week 11)\r\n\r\nIn these weeks, I mainly read the complete code and optimized some parts of the code. I also added exception handling wherever needed. I added various messages for user's help when an error occured. I also ensured that user does not enter wrong inputs in the plugin .\r\n\r\n**For each exception, There will be a message for the user.**\r\n\r\n### Step 9\t:\tOpening the file in ImageJ (Week 12)\r\n\r\nPreviously, I had added the code for opening the file in OS default application. On my mentor's recommendation, I changed it to ImageJ.\r\n\r\n**If a file is not supported by the ImageJ, it will show an error message.**\r\n\r\n### Step 10\t:\tCreated a new thread for downloading/uploading. (Week 12)\r\n\r\nSwing GUI has only a single thread. Thus, during a long process such as download/upload the plugin became unresponsive. On my mentor's advice, I spawned a new thread for download/upload.\r\n\r\n```\r\nThread thread = new Thread(\"New Thread\") {\r\n\t\t\t\t\t\t      public void run(){\r\n\t\t\t\t\t\t    \t\t// Call to Upload/Download functions\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthread.start();\r\n```\t\t\t\t\t\t\r\n\r\n**After creating a new thread for download/upload, plugin became responsive**.\r\n\r\n**This plugin now supports the multithreading, i.e. Multiple upload/download tasks can be performed simultaneously.**\r\n\r\n## Installation\r\n\r\n1. Install [ImageJ](http://rsbweb.nih.gov/ij/download.html). \r\n2. Download DropboxClient plugin from [here](https://dl.dropboxusercontent.com/u/52328771/Atin%20GSoC%20proposal/MyCloudJ_.jar).\r\n3. Put this JAR file (MyCloudJ_.jar) inside the **plugins** folder of your ImageJ.\r\n4. It's ready to use. Start your ImageJ. \r\n5. In the **plugins** menu, open **CloudConnect -> MyCloudJ**.\r\n6. Connect MyCloudJ plugin to your dropbox account and use it to download/upload.\r\n\r\n## Screen shots of MyCloudJ plugin\r\n\r\n![](https://dl.dropboxusercontent.com/u/52328771/Atin%20GSoC%20proposal/screenshot5.png)\r\n![](https://dl.dropboxusercontent.com/u/52328771/Atin%20GSoC%20proposal/screenshot2.png)\r\n![](https://dl.dropboxusercontent.com/u/52328771/Atin%20GSoC%20proposal/screenshot3.png)\r\n![](https://dl.dropboxusercontent.com/u/52328771/Atin%20GSoC%20proposal/screenshot1.png)\r\n![](https://dl.dropboxusercontent.com/u/52328771/Atin%20GSoC%20proposal/screenshot4.png)\r\n\r\n\r\n####This repository is maintained by Atin Mathur (mathuratin007@gmail.com) and Dimiter Prodanov (dimiterpp@gmail.com). Please feel free to contact us for any help regarding the plugin installation or source code pitfalls.  ","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}